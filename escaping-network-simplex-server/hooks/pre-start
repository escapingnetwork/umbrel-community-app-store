#!/bin/bash



APP_DATA_DIR="$(readlink -f "$(dirname "${BASH_SOURCE[0]}")/..")/data"
CONFIG_DIR="${APP_DATA_DIR}/smp/config"

# Path to your ini file
INI_FILE="${CONFIG_DIR}/smp-server.ini"

# Check if the INI file exists
if [ ! -f "$INI_FILE" ]; then
    echo "Error: $INI_FILE does not exist."
    exit 1
fi

# Temporary file to write changes
TEMP_FILE=$(mktemp)

# Read each line of the INI file
while IFS= read -r line
do
    # Replace placeholders with their environment variables if they exist
    if [[ $line =~ \$\{([A-Za-z0-9_]+)\} ]]; then
        var_name="${BASH_REMATCH[1]}"
        if [[ -v "$var_name" ]]; then
            new_value="${!var_name}"
            echo "${line/\$\{${var_name}\}/$new_value}" >> "$TEMP_FILE"
        else
            echo "Warning: Environment variable $var_name not set. Line unchanged." >&2
            echo "$line" >> "$TEMP_FILE"
        fi
    else
        echo "$line" >> "$TEMP_FILE"
    fi
done < "$INI_FILE"

# Replace the original file with the modified one
mv "$TEMP_FILE" "$INI_FILE"

echo "Environment variables in $INI_FILE have been replaced."